name: 'Build'
description: 'Builds zkvyper executable.'
inputs:
  target:
    description: 'Specific build target triplet.'
    required: false
    default: ''
  rustflags:
    description: 'Additional compilation flags to use for building.'
    required: false
    default: ''
runs:
  using: "composite"
  steps:
    - name: Define build target
      id: build-target
      if: inputs.target != ''
      shell: ${{ runner.os == 'Windows' && 'msys2 {0}' || 'bash' }}
      run: |
        rustup target add ${{ inputs.target }}
        echo "target=--target ${{ inputs.target }}" >> $GITHUB_OUTPUT

    - name: Build zkvyper
      shell: ${{ runner.os == 'Windows' && 'msys2 {0}' || 'bash' }}
      env:
        RUSTFLAGS: ${{ inputs.rustflags }}
      run: |
        cargo build --release ${{ steps.build-target.outputs.target }}
        echo "$PWD/target/${{ inputs.target }}/release" >> $GITHUB_PATH
